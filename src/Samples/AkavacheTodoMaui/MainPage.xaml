<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AkavacheTodoMaui.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:AkavacheTodoMaui.Converters"
    xmlns:vm="clr-namespace:AkavacheTodoMaui.ViewModels"
    Title="Akavache Todo MAUI">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:DateTimeOffsetToDateTimeConverter x:Key="DateTimeOffsetToDateTimeConverter" />
            <conv:StringToBoolConverter x:Key="StringToBoolConverter" />
            <conv:IntToBoolConverter x:Key="IntToBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">
        <!--  Header Section  -->
        <StackLayout
            Grid.Row="0"
            Padding="20"
            BackgroundColor="#673AB7">
            <Label
                FontAttributes="Bold"
                FontSize="24"
                HorizontalOptions="Center"
                Text="Akavache Todo Demo - MAUI"
                TextColor="White" />
            <Label
                FontSize="14"
                HorizontalOptions="Center"
                Text="{Binding StatusMessage}"
                TextColor="White" />
        </StackLayout>

        <!--  Main Content  -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="20" Spacing="15">

                <!--  Statistics Panel  -->
                <Border Padding="15" BackgroundColor="#F5F5F5">
                    <Grid ColumnDefinitions="*,*,*,*">
                        <StackLayout Grid.Column="0">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                HorizontalOptions="Center"
                                Text="{Binding TodoStats.TotalTodos}"
                                TextColor="#212121" />
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Text="Total"
                                TextColor="#666666" />
                        </StackLayout>

                        <StackLayout Grid.Column="1">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                HorizontalOptions="Center"
                                Text="{Binding TodoStats.CompletedTodos}"
                                TextColor="#2E7D32" />
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Text="Completed"
                                TextColor="#666666" />
                        </StackLayout>

                        <StackLayout Grid.Column="2">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                HorizontalOptions="Center"
                                Text="{Binding TodoStats.OverdueTodos}"
                                TextColor="#D32F2F" />
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Text="Overdue"
                                TextColor="#666666" />
                        </StackLayout>

                        <StackLayout Grid.Column="3">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                HorizontalOptions="Center"
                                Text="{Binding TodoStats.DueSoonTodos}"
                                TextColor="#F57C00" />
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Text="Due Soon"
                                TextColor="#666666" />
                        </StackLayout>
                    </Grid>
                </Border>

                <!--  Add New Todo Section  -->
                <Border Padding="15" BackgroundColor="White">
                    <StackLayout Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="Add New Todo"
                            TextColor="#212121" />

                        <Entry
                            Placeholder="Todo title..."
                            Text="{Binding NewTodoTitle}"
                            TextColor="#212121" />

                        <Entry
                            Placeholder="Description (optional)..."
                            Text="{Binding NewTodoDescription}"
                            TextColor="#212121" />

                        <Entry
                            Placeholder="Tags (comma-separated, optional)..."
                            Text="{Binding NewTodoTags}"
                            TextColor="#212121" />

                        <Grid ColumnDefinitions="*,100">
                            <DatePicker
                                Grid.Column="0"
                                Date="{Binding NewTodoDueDate}"
                                TextColor="#212121" />
                            <Entry
                                Grid.Column="1"
                                Placeholder="HH:mm"
                                Text="{Binding NewTodoTime}"
                                TextColor="#212121" />
                        </Grid>

                        <Picker
                            Title="Priority"
                            ItemsSource="{Binding PriorityOptions}"
                            SelectedItem="{Binding NewTodoPriority}"
                            TextColor="#212121" />

                        <Button
                            BackgroundColor="#673AB7"
                            Command="{Binding AddTodoCommand}"
                            Text="Add Todo"
                            TextColor="White" />
                    </StackLayout>
                </Border>

                <!--  Todo List  -->
                <Border Padding="15" BackgroundColor="White">
                    <StackLayout>
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="Your Todos"
                            TextColor="#212121" />

                        <CollectionView ItemsSource="{Binding Todos}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="2"
                                        Padding="10"
                                        BackgroundColor="{Binding BackgroundColor}">
                                        <Grid ColumnDefinitions="8,*,Auto,Auto,Auto">
                                            <!--  Priority Indicator  -->
                                            <BoxView
                                                Grid.Column="0"
                                                BackgroundColor="{Binding PriorityColor}"
                                                HeightRequest="40"
                                                VerticalOptions="Center"
                                                WidthRequest="4" />

                                            <!--  Todo Content  -->
                                            <StackLayout Grid.Column="1" Margin="10,0,0,0">
                                                <Label
                                                    FontAttributes="Bold"
                                                    FontSize="16"
                                                    Text="{Binding TodoItem.Title}"
                                                    TextColor="{Binding TextColor}" />
                                                <Label
                                                    FontSize="14"
                                                    IsVisible="{Binding TodoItem.Description, Converter={StaticResource StringToBoolConverter}}"
                                                    Text="{Binding TodoItem.Description}"
                                                    TextColor="{Binding TextColor}" />
                                                <Label
                                                    FontSize="12"
                                                    Text="{Binding DueDateDisplay}"
                                                    TextColor="#666666" />
                                                <Label
                                                    FontSize="10"
                                                    IsVisible="{Binding TagsDisplay, Converter={StaticResource StringToBoolConverter}}"
                                                    Text="{Binding TagsDisplay}"
                                                    TextColor="#9C27B0" />
                                            </StackLayout>

                                            <!--  Completion Toggle  -->
                                            <CheckBox
                                                Grid.Column="2"
                                                IsChecked="{Binding TodoItem.IsCompleted}"
                                                VerticalOptions="Center" />

                                            <!--  Edit Button  -->
                                            <Button
                                                Grid.Column="3"
                                                BackgroundColor="LightGray"
                                                Command="{Binding EditCommand}"
                                                FontSize="12"
                                                HeightRequest="30"
                                                Text="Edit"
                                                TextColor="Black"
                                                WidthRequest="50" />

                                            <!--  Delete Button  -->
                                            <Button
                                                Grid.Column="4"
                                                BackgroundColor="Red"
                                                Command="{Binding DeleteCommand}"
                                                FontAttributes="Bold"
                                                FontSize="18"
                                                HeightRequest="30"
                                                Text="×"
                                                TextColor="White"
                                                WidthRequest="30" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Border>

                <!--  Notifications Panel  -->
                <Border
                    Padding="15"
                    BackgroundColor="#FFFDE7"
                    IsVisible="{Binding Notifications.Count, Converter={StaticResource IntToBoolConverter}}">
                    <StackLayout>
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="Recent Notifications"
                            TextColor="#E65100" />
                        <CollectionView HeightRequest="100" ItemsSource="{Binding Notifications}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label
                                        Padding="5"
                                        BackgroundColor="#FFF8E1"
                                        FontSize="12"
                                        Text="{Binding .}"
                                        TextColor="#BF360C" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Border>

                <!--  Cache Information Panel  -->
                <Border Padding="15" BackgroundColor="#E3F2FD">
                    <StackLayout>
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="Cache Information"
                            TextColor="#0D47A1" />
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto">
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                FontSize="12"
                                Text="User Cache Keys:"
                                TextColor="#1565C0" />
                            <Label
                                Grid.Row="0"
                                Grid.Column="1"
                                FontSize="12"
                                Text="{Binding CacheInfo.UserAccountKeys}"
                                TextColor="#1976D2" />

                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                FontSize="12"
                                Text="Local Cache Keys:"
                                TextColor="#1565C0" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="1"
                                FontSize="12"
                                Text="{Binding CacheInfo.LocalMachineKeys}"
                                TextColor="#1976D2" />

                            <Label
                                Grid.Row="2"
                                Grid.Column="0"
                                FontSize="12"
                                Text="Secure Cache Keys:"
                                TextColor="#1565C0" />
                            <Label
                                Grid.Row="2"
                                Grid.Column="1"
                                FontSize="12"
                                Text="{Binding CacheInfo.SecureKeys}"
                                TextColor="#1976D2" />
                        </Grid>
                    </StackLayout>
                </Border>
            </StackLayout>
        </ScrollView>

        <!--  Footer Actions  -->
        <StackLayout
            Grid.Row="2"
            Padding="20"
            BackgroundColor="#F5F5F5"
            Orientation="Horizontal"
            Spacing="10">
            <Button
                BackgroundColor="White"
                Command="{Binding RefreshCommand}"
                Text="Refresh"
                TextColor="#212121" />
            <Button
                BackgroundColor="White"
                Command="{Binding ClearCompletedCommand}"
                Text="Clear Completed"
                TextColor="#212121" />
            <Button
                BackgroundColor="White"
                Command="{Binding LoadSampleDataCommand}"
                Text="Load Sample"
                TextColor="#212121" />
            <Button
                BackgroundColor="LightBlue"
                Command="{Binding TestDateCommand}"
                Text="Test Date"
                TextColor="#212121" />
            <Button
                BackgroundColor="White"
                Command="{Binding CleanupCacheCommand}"
                Text="Cleanup Cache"
                TextColor="#212121" />
        </StackLayout>

        <!--  Loading Indicator  -->
        <ActivityIndicator
            Grid.Row="1"
            HorizontalOptions="Center"
            IsRunning="{Binding IsLoading}"
            IsVisible="{Binding IsLoading}"
            VerticalOptions="Center" />
    </Grid>

</ContentPage>
